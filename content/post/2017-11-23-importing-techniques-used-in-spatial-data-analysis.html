---
title: Importing Techniques Used in Spatial Data Analysis
author: sumendar
date: '2017-11-23'
slug: importing-techniques-used-in-spatial-data-analysis
categories: []
tags: []
output: 
  html_document: 
    self_contained: no
    toc: yes
---



<p><strong>In this post we are going to take a look at various data importing techniques used for spatial data analysis</strong></p>
<div id="importing-data-from-tables-read.table" class="section level2">
<h2>Importing Data from Tables (read.table)</h2>
<ul>
<li>Opening data</li>
<li>Importing csv files</li>
<li>Checking the data structure for consistency</li>
</ul>
<p><strong>Accessing and importing open access environmental data is a crucial skill for data scientists. This section teaches you how to download data from the Web, import it in R and check it for consistency.</strong></p>
<p><strong>In this section, we are going to take a look at…</strong></p>
<ul>
<li>Download open-access data from the USGS website</li>
<li>Import it in R using read.table</li>
<li>Check its structure to start exploring the data</li>
</ul>
<pre class="r"><code>#Set the URL with the CSV Files
URL &lt;- &quot;http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.csv&quot;</code></pre>
<pre class="r"><code>#Load the CSV File
Data &lt;- read.table(file=URL, 
                   sep=&quot;,&quot;, 
                   header=TRUE, 
                   na.string=&quot;&quot;)</code></pre>
<pre class="r"><code>#Help function
help(read.table)</code></pre>
<pre class="r"><code>#Examining the data
str(Data)</code></pre>
<pre><code>## &#39;data.frame&#39;:    145 obs. of  22 variables:
##  $ time           : Factor w/ 145 levels &quot;2017-11-25T16:44:02.530Z&quot;,..: 145 144 143 142 141 140 139 138 137 136 ...
##  $ latitude       : num  33.7 36.6 61.9 36.1 33.5 ...
##  $ longitude      : num  -116.7 -121.1 -150.5 -97.9 -116.8 ...
##  $ depth          : num  17.4 8.12 56.2 4.54 4.45 ...
##  $ mag            : num  1.94 1.32 1.8 2.2 0.25 1.56 0.51 1.08 0.65 1.18 ...
##  $ magType        : Factor w/ 5 levels &quot;mb&quot;,&quot;mb_lg&quot;,&quot;md&quot;,..: 4 3 4 2 4 4 4 4 4 3 ...
##  $ nst            : int  76 8 NA NA 16 12 20 11 31 17 ...
##  $ gap            : num  17 102 NA 41 73 182 114 88 43 81 ...
##  $ dmin           : num  0.01712 0.03987 NA 0.133 0.00532 ...
##  $ rms            : num  0.18 0.03 0.37 0.1 0.13 0.2 0.15 0.21 0.16 0.04 ...
##  $ net            : Factor w/ 9 levels &quot;ak&quot;,&quot;ci&quot;,&quot;hv&quot;,..: 2 4 1 8 2 2 2 2 2 4 ...
##  $ id             : Factor w/ 145 levels &quot;ak17389841&quot;,&quot;ak17390012&quot;,..: 67 99 26 142 66 65 64 63 62 98 ...
##  $ updated        : Factor w/ 145 levels &quot;2017-11-25T16:47:43.649Z&quot;,..: 142 144 133 137 130 129 128 125 123 140 ...
##  $ place          : Factor w/ 132 levels &quot;0km N of The Geysers, California&quot;,..: 86 45 54 63 4 82 44 57 129 65 ...
##  $ type           : Factor w/ 2 levels &quot;earthquake&quot;,&quot;explosion&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ horizontalError: num  0.16 0.44 NA 0.9 0.27 0.96 0.34 0.65 0.22 0.3 ...
##  $ depthError     : num  0.31 1.04 0.5 4.3 0.47 ...
##  $ magError       : num  0.205 0.13 NA 0.161 0.042 0.204 0.128 0.233 0.159 0.17 ...
##  $ magNst         : int  26 7 NA 10 7 16 15 20 23 5 ...
##  $ status         : Factor w/ 2 levels &quot;automatic&quot;,&quot;reviewed&quot;: 1 1 1 2 1 1 1 1 1 1 ...
##  $ locationSource : Factor w/ 9 levels &quot;ak&quot;,&quot;ci&quot;,&quot;hv&quot;,..: 2 4 1 8 2 2 2 2 2 4 ...
##  $ magSource      : Factor w/ 9 levels &quot;ak&quot;,&quot;ci&quot;,&quot;hv&quot;,..: 2 4 1 8 2 2 2 2 2 4 ...</code></pre>
</div>
<div id="downloading-open-data-from-ftp-sites" class="section level2">
<h2>Downloading Open Data from FTP Sites</h2>
<p><strong>Often times, datasets are provided for free, but on FTP, websites and practitioners need to be able to access them. R is perfectly capable of downloading and importing data from FTP sites.</strong></p>
<p><strong>In this section, we are going to take a look at…</strong></p>
<ul>
<li>Understand the basics of downloading data in R</li>
<li>Download the data with the download.file function</li>
<li>Learn how to handle compressed formats</li>
</ul>
<pre class="r"><code>#Load required packages
library(RCurl)</code></pre>
<pre><code>## Loading required package: bitops</code></pre>
<pre class="r"><code>library(XML)</code></pre>
<pre class="r"><code>#Create a list with all the files on the FTP site
list &lt;- getURL(&quot;ftp://ftp.ncdc.noaa.gov/pub/data/gsod/2016/&quot;, 
               dirlistonly = TRUE) </code></pre>
<pre class="r"><code>#Clean the list 
FileList &lt;- strsplit(list, split=&quot;\r\n&quot;)</code></pre>
<pre class="r"><code>#Create a new directory where to download these files
DIR &lt;- paste(getwd(),&quot;/NOAAFiles&quot;,sep=&quot;&quot;)
dir.create(DIR)</code></pre>
<pre><code>## Warning in dir.create(DIR): &#39;E:\Projects\sumendar.github.io\content\post
## \NOAAFiles&#39; already exists</code></pre>
<pre class="r"><code>#Loop to download the files
for(FileName in unlist(FileList)){
  URL &lt;- paste0(&quot;ftp://ftp.ncdc.noaa.gov/pub/data/gsod/2016/&quot;,FileName)
  download.file(URL, destfile=paste0(DIR,&quot;/&quot;,FileName), method=&quot;auto&quot;, 
                mode=&quot;wb&quot;)
}</code></pre>
<pre class="r"><code>#A more elegant way
DownloadFile &lt;- function(x){
  URL &lt;- paste0(&quot;ftp://ftp.ncdc.noaa.gov/pub/data/gsod/2016/&quot;,x)
  download.file(URL, destfile=paste0(DIR,&quot;/&quot;,x), method=&quot;auto&quot;, mode=&quot;wb&quot;)
}
lapply(unlist(FileList)[1:5], DownloadFile)</code></pre>
<pre class="r"><code>#Dowload a compressed file
URL &lt;- &quot;ftp://ftp.ncdc.noaa.gov/pub/data/gsod/2015/gsod_2015.tar&quot;
download.file(URL, destfile=paste0(DIR,&quot;/gsod_2015.tar&quot;),
              method=&quot;auto&quot;,mode=&quot;wb&quot;)

untar(paste0(getwd(),&quot;/NOAAFiles/&quot;,&quot;gsod_2015.tar&quot;), 
      exdir=paste0(getwd(),&quot;/NOAAFiles&quot;))</code></pre>
<pre class="r"><code>help(unzip)
#For more information on the full experiment please visit:
#http://r-video-tutorial.blogspot.ch/2014/12/accessing-cleaning-and-plotting-noaa.html</code></pre>
</div>
<div id="fixed-width-format" class="section level2">
<h2>Fixed-Width Format</h2>
<p><strong>In this section, we are going to take a look at…</strong></p>
<ul>
<li>Creating a list of files in a folder</li>
<li>Opening data compressed in gzip</li>
<li>Opening data in fixed width format</li>
</ul>
<pre class="r"><code>help(list.files)</code></pre>
<pre class="r"><code>setwd(&quot;./NOAAFiles&quot;)
#Open the first file in the list
data &lt;- read.fwf(gzfile(FileList[1],open=&quot;rt&quot;),
                 header=F,
                 skip=1,
                 widths=c(6,1,5,2,8,4,4,108))</code></pre>
<pre><code>## Warning in readLines(file, n = skip): seek on a gzfile connection returned
## an internal error</code></pre>
<pre><code>## Warning in readLines(file, n = thisblock): seek on a gzfile connection
## returned an internal error</code></pre>
<pre><code>## Warning in readLines(file, n = thisblock): incomplete final line found on
## &#39;339240-99999-2016.op.gz&#39;</code></pre>
<pre class="r"><code>str(data)</code></pre>
<pre><code>## &#39;data.frame&#39;:    325 obs. of  8 variables:
##  $ V1: int  339240 339240 339240 339240 339240 339240 339240 339240 339240 339240 ...
##  $ V2: logi  NA NA NA NA NA NA ...
##  $ V3: int  99999 99999 99999 99999 99999 99999 99999 99999 99999 99999 ...
##  $ V4: logi  NA NA NA NA NA NA ...
##  $ V5: int  20160101 20160102 20160103 20160104 20160105 20160106 20160107 20160108 20160109 20160110 ...
##  $ V6: logi  NA NA NA NA NA NA ...
##  $ V7: num  18.2 15.8 9.9 14 26.8 30.2 45.6 36.6 40.6 44.5 ...
##  $ V8: Factor w/ 324 levels &quot;  5    40.7  5  1008.9  5  1007.7  5    5.5  5    5.1  5    7.8  999.9    49.6    37.2   0.30F 999.9  010000&quot;,..: 18 16 15 17 26 33 10 46 48 108 ...</code></pre>
<pre class="r"><code>#Clean it from unwanted columns
data.clean &lt;- data[,c(&quot;V1&quot;, &quot;V3&quot;, &quot;V5&quot;, &quot;V7&quot;)]</code></pre>
<pre class="r"><code>str(data.clean)</code></pre>
<pre><code>## &#39;data.frame&#39;:    325 obs. of  4 variables:
##  $ V1: int  339240 339240 339240 339240 339240 339240 339240 339240 339240 339240 ...
##  $ V3: int  99999 99999 99999 99999 99999 99999 99999 99999 99999 99999 ...
##  $ V5: int  20160101 20160102 20160103 20160104 20160105 20160106 20160107 20160108 20160109 20160110 ...
##  $ V7: num  18.2 15.8 9.9 14 26.8 30.2 45.6 36.6 40.6 44.5 ...</code></pre>
<pre class="r"><code>#Change the names of the columns
names(data.clean) &lt;- c(&quot;STN&quot;, &quot;WBAN&quot;, &quot;YEARMODA&quot;, &quot;TEMP&quot;)</code></pre>
<pre class="r"><code>head(data.clean)</code></pre>
<pre><code>##      STN  WBAN YEARMODA TEMP
## 1 339240 99999 20160101 18.2
## 2 339240 99999 20160102 15.8
## 3 339240 99999 20160103  9.9
## 4 339240 99999 20160104 14.0
## 5 339240 99999 20160105 26.8
## 6 339240 99999 20160106 30.2</code></pre>
</div>
